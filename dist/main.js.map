{"version":3,"sources":["../src/main.ts"],"sourcesContent":["import { NestFactory } from '@nestjs/core';\r\nimport { AppModule } from './app.module';\r\nimport * as bodyParser from 'body-parser';\r\nimport { SwaggerModule, DocumentBuilder } from '@nestjs/swagger';\r\nimport { ValidationPipe } from '@nestjs/common';\r\nimport { LoggerMiddleware } from './common/middleware/logger.middleware';\r\nimport { NestExpressApplication } from '@nestjs/platform-express';\r\nimport { join } from 'path';\r\nimport { ValidationExceptionFilter } from './common/filters/validation-exception.filter';\r\nimport { NotFoundExceptionFilter } from './common/filters/not-found-exception.filter';\r\nimport { AllExceptionsFilter } from './common/filters/all-exceptions.filter';\r\nimport { LoggerService } from './common/utils/logger.service';\r\n\r\n// import dataSource from './data-source';\r\nconst logger = new LoggerService();\r\n\r\n(async () => {\r\n  try {\r\n    logger.info('Starting application bootstrap...', 'Bootstrap');\r\n\r\n    // Optimize for production environment\r\n    const isProduction = process.env.NODE_ENV === 'production';\r\n\r\n    const app = await NestFactory.create<NestExpressApplication>(AppModule, {\r\n      // Reduce memory usage\r\n      logger: isProduction\r\n        ? ['error', 'warn']\r\n        : ['log', 'error', 'warn', 'debug'],\r\n    });\r\n\r\n    logger.info('Application created successfully', 'Bootstrap');\r\n\r\n    // Configure static file serving for uploads\r\n    app.useStaticAssets(join(__dirname, '..', 'uploads'), {\r\n      prefix: '/uploads',\r\n    });\r\n\r\n    // await dataSource.initialize();\r\n    // await dataSource.runMigrations();\r\n\r\n    // Only enable Swagger in development\r\n    if (!isProduction) {\r\n      const config = new DocumentBuilder()\r\n        .setTitle('rabbit')\r\n        .setDescription('The rabbit API description')\r\n        .setVersion('1.0')\r\n        .addBearerAuth() // Add Bearer Auth to Swagger\r\n        .build();\r\n      const documentFactory = () => SwaggerModule.createDocument(app, config);\r\n      SwaggerModule.setup('api', app, documentFactory);\r\n    }\r\n\r\n    // Reduce body parser limits to save memory\r\n    const bodyLimit = isProduction ? '10mb' : '50mb';\r\n    app.use(bodyParser.json({ limit: bodyLimit }));\r\n    app.use(bodyParser.urlencoded({ extended: true, limit: bodyLimit }));\r\n\r\n    app.use(LoggerMiddleware);\r\n    app.enableCors({\r\n      origin: '*',\r\n      methods: 'GET,HEAD,PUT,PATCH,POST,DELETE',\r\n      credentials: false,\r\n    });\r\n    app.useGlobalPipes(\r\n      new ValidationPipe({\r\n        transform: true,\r\n        transformOptions: {\r\n          enableImplicitConversion: true, // <- This line here\r\n        },\r\n        whitelist: true,\r\n        forbidNonWhitelisted: true,\r\n      }),\r\n    );\r\n\r\n    // Apply global exception filters\r\n    app.useGlobalFilters(\r\n      new AllExceptionsFilter(new LoggerService()),\r\n      new ValidationExceptionFilter(),\r\n      new NotFoundExceptionFilter(),\r\n    );\r\n\r\n    logger.info('Starting server...', 'Bootstrap');\r\n    await app.listen(process.env.PORT ?? 3000, '0.0.0.0');\r\n    logger.info(\r\n      `Application is running on: http://0.0.0.0:${process.env.PORT ?? 3000}`,\r\n      'Bootstrap',\r\n    );\r\n  } catch (error) {\r\n    logger.logError(error, 'Bootstrap');\r\n    process.exit(1);\r\n  }\r\n})();\r\n"],"names":["logger","LoggerService","info","isProduction","process","env","NODE_ENV","app","NestFactory","create","AppModule","useStaticAssets","join","__dirname","prefix","config","DocumentBuilder","setTitle","setDescription","setVersion","addBearerAuth","build","documentFactory","SwaggerModule","createDocument","setup","bodyLimit","use","bodyParser","json","limit","urlencoded","extended","LoggerMiddleware","enableCors","origin","methods","credentials","useGlobalPipes","ValidationPipe","transform","transformOptions","enableImplicitConversion","whitelist","forbidNonWhitelisted","useGlobalFilters","AllExceptionsFilter","ValidationExceptionFilter","NotFoundExceptionFilter","listen","PORT","error","logError","exit"],"mappings":";;;;sBAA4B;2BACF;oEACE;yBACmB;wBAChB;kCACE;sBAEZ;2CACqB;yCACF;qCACJ;+BACN;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAE9B,0CAA0C;AAC1C,MAAMA,SAAS,IAAIC,4BAAa;AAE/B,CAAA;IACC,IAAI;QACFD,OAAOE,IAAI,CAAC,qCAAqC;QAEjD,sCAAsC;QACtC,MAAMC,eAAeC,QAAQC,GAAG,CAACC,QAAQ,KAAK;QAE9C,MAAMC,MAAM,MAAMC,iBAAW,CAACC,MAAM,CAAyBC,oBAAS,EAAE;YACtE,sBAAsB;YACtBV,QAAQG,eACJ;gBAAC;gBAAS;aAAO,GACjB;gBAAC;gBAAO;gBAAS;gBAAQ;aAAQ;QACvC;QAEAH,OAAOE,IAAI,CAAC,oCAAoC;QAEhD,4CAA4C;QAC5CK,IAAII,eAAe,CAACC,IAAAA,UAAI,EAACC,WAAW,MAAM,YAAY;YACpDC,QAAQ;QACV;QAEA,iCAAiC;QACjC,oCAAoC;QAEpC,qCAAqC;QACrC,IAAI,CAACX,cAAc;YACjB,MAAMY,SAAS,IAAIC,wBAAe,GAC/BC,QAAQ,CAAC,UACTC,cAAc,CAAC,8BACfC,UAAU,CAAC,OACXC,aAAa,GAAG,6BAA6B;aAC7CC,KAAK;YACR,MAAMC,kBAAkB,IAAMC,sBAAa,CAACC,cAAc,CAACjB,KAAKQ;YAChEQ,sBAAa,CAACE,KAAK,CAAC,OAAOlB,KAAKe;QAClC;QAEA,2CAA2C;QAC3C,MAAMI,YAAYvB,eAAe,SAAS;QAC1CI,IAAIoB,GAAG,CAACC,YAAWC,IAAI,CAAC;YAAEC,OAAOJ;QAAU;QAC3CnB,IAAIoB,GAAG,CAACC,YAAWG,UAAU,CAAC;YAAEC,UAAU;YAAMF,OAAOJ;QAAU;QAEjEnB,IAAIoB,GAAG,CAACM,kCAAgB;QACxB1B,IAAI2B,UAAU,CAAC;YACbC,QAAQ;YACRC,SAAS;YACTC,aAAa;QACf;QACA9B,IAAI+B,cAAc,CAChB,IAAIC,sBAAc,CAAC;YACjBC,WAAW;YACXC,kBAAkB;gBAChBC,0BAA0B;YAC5B;YACAC,WAAW;YACXC,sBAAsB;QACxB;QAGF,iCAAiC;QACjCrC,IAAIsC,gBAAgB,CAClB,IAAIC,wCAAmB,CAAC,IAAI7C,4BAAa,KACzC,IAAI8C,oDAAyB,IAC7B,IAAIC,gDAAuB;QAG7BhD,OAAOE,IAAI,CAAC,sBAAsB;YACjBE;QAAjB,MAAMG,IAAI0C,MAAM,CAAC7C,CAAAA,oBAAAA,QAAQC,GAAG,CAAC6C,IAAI,cAAhB9C,+BAAAA,oBAAoB,MAAM;YAEIA;QAD/CJ,OAAOE,IAAI,CACT,CAAC,0CAA0C,EAAEE,CAAAA,qBAAAA,QAAQC,GAAG,CAAC6C,IAAI,cAAhB9C,gCAAAA,qBAAoB,MAAM,EACvE;IAEJ,EAAE,OAAO+C,OAAO;QACdnD,OAAOoD,QAAQ,CAACD,OAAO;QACvB/C,QAAQiD,IAAI,CAAC;IACf;AACF,CAAA"}