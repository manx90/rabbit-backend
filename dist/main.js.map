{"version":3,"sources":["../src/main.ts"],"sourcesContent":["import { NestFactory } from '@nestjs/core';\r\nimport { AppModule } from './app.module';\r\nimport * as bodyParser from 'body-parser';\r\nimport { SwaggerModule, DocumentBuilder } from '@nestjs/swagger';\r\nimport { ValidationPipe } from '@nestjs/common';\r\nimport { LoggerMiddleware } from './common/middleware/logger.middleware';\r\nimport { NestExpressApplication } from '@nestjs/platform-express';\r\nimport { join } from 'path';\r\nimport { ValidationExceptionFilter } from './common/filters/validation-exception.filter';\r\nimport { NotFoundExceptionFilter } from './common/filters/not-found-exception.filter';\r\n\r\n// import dataSource from './data-source';\r\nasync function bootstrap() {\r\n  // Optimize for production environment\r\n  const isProduction = process.env.NODE_ENV === 'production';\r\n\r\n  const app = await NestFactory.create<NestExpressApplication>(AppModule, {\r\n    // Reduce memory usage\r\n    logger: isProduction\r\n      ? ['error', 'warn']\r\n      : ['log', 'error', 'warn', 'debug'],\r\n  });\r\n\r\n  // Configure static file serving for uploads\r\n  app.useStaticAssets(join(__dirname, '..', 'uploads'), {\r\n    prefix: '/uploads',\r\n  });\r\n\r\n  // await dataSource.initialize();\r\n  // await dataSource.runMigrations();\r\n\r\n  // Only enable Swagger in development\r\n  if (!isProduction) {\r\n    const config = new DocumentBuilder()\r\n      .setTitle('rabbit')\r\n      .setDescription('The rabbit API description')\r\n      .setVersion('1.0')\r\n      .addBearerAuth() // Add Bearer Auth to Swagger\r\n      .build();\r\n    const documentFactory = () => SwaggerModule.createDocument(app, config);\r\n    SwaggerModule.setup('api', app, documentFactory);\r\n  }\r\n\r\n  // Reduce body parser limits to save memory\r\n  const bodyLimit = isProduction ? '10mb' : '50mb';\r\n  app.use(bodyParser.json({ limit: bodyLimit }));\r\n  app.use(bodyParser.urlencoded({ extended: true, limit: bodyLimit }));\r\n\r\n  app.use(LoggerMiddleware);\r\n  app.enableCors({\r\n    origin: '*',\r\n    methods: 'GET,HEAD,PUT,PATCH,POST,DELETE',\r\n    credentials: false,\r\n  });\r\n  app.useGlobalPipes(\r\n    new ValidationPipe({\r\n      transform: true,\r\n      transformOptions: {\r\n        enableImplicitConversion: true, // <- This line here\r\n      },\r\n      whitelist: true,\r\n      forbidNonWhitelisted: true,\r\n    }),\r\n  );\r\n\r\n  // Apply global exception filters\r\n  app.useGlobalFilters(\r\n    new ValidationExceptionFilter(),\r\n    new NotFoundExceptionFilter(),\r\n  );\r\n\r\n  await app.listen(process.env.PORT ?? 3000, 'localhost');\r\n}\r\n\r\nbootstrap();\r\n"],"names":["bootstrap","isProduction","process","env","NODE_ENV","app","NestFactory","create","AppModule","logger","useStaticAssets","join","__dirname","prefix","config","DocumentBuilder","setTitle","setDescription","setVersion","addBearerAuth","build","documentFactory","SwaggerModule","createDocument","setup","bodyLimit","use","bodyParser","json","limit","urlencoded","extended","LoggerMiddleware","enableCors","origin","methods","credentials","useGlobalPipes","ValidationPipe","transform","transformOptions","enableImplicitConversion","whitelist","forbidNonWhitelisted","useGlobalFilters","ValidationExceptionFilter","NotFoundExceptionFilter","listen","PORT"],"mappings":";;;;sBAA4B;2BACF;oEACE;yBACmB;wBAChB;kCACE;sBAEZ;2CACqB;yCACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAExC,0CAA0C;AAC1C,eAAeA;IACb,sCAAsC;IACtC,MAAMC,eAAeC,QAAQC,GAAG,CAACC,QAAQ,KAAK;IAE9C,MAAMC,MAAM,MAAMC,iBAAW,CAACC,MAAM,CAAyBC,oBAAS,EAAE;QACtE,sBAAsB;QACtBC,QAAQR,eACJ;YAAC;YAAS;SAAO,GACjB;YAAC;YAAO;YAAS;YAAQ;SAAQ;IACvC;IAEA,4CAA4C;IAC5CI,IAAIK,eAAe,CAACC,IAAAA,UAAI,EAACC,WAAW,MAAM,YAAY;QACpDC,QAAQ;IACV;IAEA,iCAAiC;IACjC,oCAAoC;IAEpC,qCAAqC;IACrC,IAAI,CAACZ,cAAc;QACjB,MAAMa,SAAS,IAAIC,wBAAe,GAC/BC,QAAQ,CAAC,UACTC,cAAc,CAAC,8BACfC,UAAU,CAAC,OACXC,aAAa,GAAG,6BAA6B;SAC7CC,KAAK;QACR,MAAMC,kBAAkB,IAAMC,sBAAa,CAACC,cAAc,CAAClB,KAAKS;QAChEQ,sBAAa,CAACE,KAAK,CAAC,OAAOnB,KAAKgB;IAClC;IAEA,2CAA2C;IAC3C,MAAMI,YAAYxB,eAAe,SAAS;IAC1CI,IAAIqB,GAAG,CAACC,YAAWC,IAAI,CAAC;QAAEC,OAAOJ;IAAU;IAC3CpB,IAAIqB,GAAG,CAACC,YAAWG,UAAU,CAAC;QAAEC,UAAU;QAAMF,OAAOJ;IAAU;IAEjEpB,IAAIqB,GAAG,CAACM,kCAAgB;IACxB3B,IAAI4B,UAAU,CAAC;QACbC,QAAQ;QACRC,SAAS;QACTC,aAAa;IACf;IACA/B,IAAIgC,cAAc,CAChB,IAAIC,sBAAc,CAAC;QACjBC,WAAW;QACXC,kBAAkB;YAChBC,0BAA0B;QAC5B;QACAC,WAAW;QACXC,sBAAsB;IACxB;IAGF,iCAAiC;IACjCtC,IAAIuC,gBAAgB,CAClB,IAAIC,oDAAyB,IAC7B,IAAIC,gDAAuB;QAGZ5C;IAAjB,MAAMG,IAAI0C,MAAM,CAAC7C,CAAAA,oBAAAA,QAAQC,GAAG,CAAC6C,IAAI,cAAhB9C,+BAAAA,oBAAoB,MAAM;AAC7C;AAEAF"}