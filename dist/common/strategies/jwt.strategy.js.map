{"version":3,"sources":["../../../src/common/strategies/jwt.strategy.ts"],"sourcesContent":["import { Injectable, UnauthorizedException } from '@nestjs/common';\nimport { PassportStrategy } from '@nestjs/passport';\nimport { ExtractJwt, Strategy as StrategyBase } from 'passport-jwt';\nimport { AuthService } from '../../auth/auth.service';\nimport { AppConfigService } from '../../config/config.service';\n\nexport interface JwtPayload {\n  sub: string;\n  username: string;\n  role: string;\n}\n\n@Injectable()\nexport class JwtStrategy extends PassportStrategy(StrategyBase) {\n  constructor(\n    private readonly authService: AuthService,\n    private readonly configService: AppConfigService,\n  ) {\n    super({\n      jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),\n      secretOrKey: configService.jwtAccessToken!,\n    });\n  }\n\n  async validate(payload: JwtPayload) {\n    const user = await this.authService.findById(payload.sub);\n    if (!user) throw new UnauthorizedException();\n    // user must include .role\n    return user;\n  }\n}\n"],"names":["JwtStrategy","PassportStrategy","StrategyBase","validate","payload","user","authService","findById","sub","UnauthorizedException","constructor","configService","jwtFromRequest","ExtractJwt","fromAuthHeaderAsBearerToken","secretOrKey","jwtAccessToken"],"mappings":";;;;+BAaaA;;;eAAAA;;;wBAbqC;0BACjB;6BACoB;6BACzB;+BACK;;;;;;;;;;AAS1B,IAAA,AAAMA,cAAN,MAAMA,oBAAoBC,IAAAA,0BAAgB,EAACC,qBAAY;IAW5D,MAAMC,SAASC,OAAmB,EAAE;QAClC,MAAMC,OAAO,MAAM,IAAI,CAACC,WAAW,CAACC,QAAQ,CAACH,QAAQI,GAAG;QACxD,IAAI,CAACH,MAAM,MAAM,IAAII,6BAAqB;QAC1C,0BAA0B;QAC1B,OAAOJ;IACT;IAfAK,YACE,AAAiBJ,WAAwB,EACzC,AAAiBK,aAA+B,CAChD;QACA,KAAK,CAAC;YACJC,gBAAgBC,uBAAU,CAACC,2BAA2B;YACtDC,aAAaJ,cAAcK,cAAc;QAC3C,SANiBV,cAAAA,kBACAK,gBAAAA;IAMnB;AAQF"}