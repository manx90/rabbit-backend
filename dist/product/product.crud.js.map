{"version":3,"sources":["../../src/product/product.crud.ts"],"sourcesContent":["/* eslint-disable prettier/prettier */\n/* eslint-disable @typescript-eslint/no-unsafe-return */\n/* eslint-disable @typescript-eslint/no-unsafe-assignment */\n/* eslint-disable @typescript-eslint/no-unsafe-member-access */\n/* eslint-disable @typescript-eslint/no-unsafe-call */\nimport {\n  BadRequestException,\n  Injectable,\n  NotFoundException,\n} from '@nestjs/common';\nimport { ConfigService } from '@nestjs/config';\nimport { InjectRepository } from '@nestjs/typeorm';\nimport { Request } from 'express';\nimport { ParsedQs } from 'qs';\nimport { auth } from 'src/auth/entities/auth.entity';\nimport { PublishState } from 'src/common/interfaces/entity.interface';\nimport { ApiFeatures } from 'src/common/utils/api-features';\nimport { Repository } from 'typeorm';\nimport { FileStorageService } from '../file-storage/file-storage.service';\nimport { LoggerService } from '../common/utils/logger.service';\nimport { CreateProductDto, UpdateProductDto } from './dto/Product.dto';\nimport { category, subCategory } from './entities/Category.entity';\nimport { product } from './entities/product.entity';\n\ninterface UploadFiles {\n  images?: Express.Multer.File[];\n  imgCover?: Express.Multer.File[];\n  imgSizeChart?: Express.Multer.File[];\n  imgMeasure?: Express.Multer.File[];\n  imgColors?: Express.Multer.File[];\n}\n\n@Injectable()\nexport class ProductCrud {\n  constructor(\n    @InjectRepository(product)\n    private readonly productRepo: Repository<product>,\n    @InjectRepository(category)\n    private readonly categoryRepo: Repository<category>,\n    @InjectRepository(subCategory)\n    private readonly subCategoryRepo: Repository<subCategory>,\n    private readonly fileStorageService: FileStorageService,\n    private readonly configService: ConfigService,\n    private readonly logger: LoggerService,\n  ) {}\n\n  private async saveFiles(\n    files: Express.Multer.File[] = [],\n    productName: string,\n    subDirectory: string,\n  ): Promise<string[]> {\n    const productPath = `products/${productName.replace(/\\s+/g, '_').toLowerCase()}/${subDirectory}`;\n    return await this.fileStorageService.saveFiles(files, productPath, {\n      quality: 50,\n      format: 'jpeg',\n      progressive: true,\n    });\n  }\n\n  private async saveFile(\n    file: Express.Multer.File,\n    productName: string,\n    subDirectory: string,\n  ): Promise<string> {\n    const productPath = `products/${productName.replace(/\\s+/g, '_').toLowerCase()}/${subDirectory}`;\n    // Skip compression for sizechart and measure files\n    if (subDirectory === 'sizechart' || subDirectory === 'measure') {\n      // Don't compress these files - keep original quality\n      return await this.fileStorageService.saveFile(file, productPath, {\n        quality: 100, // Keep original quality\n        format: 'jpeg',\n        progressive: true,\n      });\n    } else {\n      return await this.fileStorageService.saveFile(file, productPath, {\n        quality: 50,\n        format: 'jpeg',\n        progressive: true,\n      });\n    }\n  }\n\n  private async uploadFiles(\n    files: UploadFiles,\n    productName: string,\n  ): Promise<{\n    images?: string[];\n    imgCover?: string;\n    imgSizeChart?: string;\n    imgMeasure?: string;\n    imgColors?: string[];\n  }> {\n    const result: any = {};\n\n    if (files.images && files.images.length > 0) {\n      result.images = await this.saveFiles(files.images, productName, 'images');\n    }\n    if (files.imgCover && files.imgCover.length > 0) {\n      result.imgCover = await this.saveFile(\n        files.imgCover[0],\n        productName,\n        'cover',\n      );\n    }\n    if (files.imgSizeChart && files.imgSizeChart.length > 0) {\n      result.imgSizeChart = await this.saveFile(\n        files.imgSizeChart[0],\n        productName,\n        'size-chart',\n      );\n    }\n    if (files.imgMeasure && files.imgMeasure.length > 0) {\n      result.imgMeasure = await this.saveFile(\n        files.imgMeasure[0],\n        productName,\n        'measure',\n      );\n    }\n    if (files.imgColors && files.imgColors.length > 0) {\n      result.imgColors = await this.saveFiles(\n        files.imgColors,\n        productName,\n        'colors',\n      );\n    }\n    return result;\n  }\n\n  private transformProductUrls(products: product[], req: Request): any[] {\n    const protocol = req.protocol || 'http';\n    const host = req.get('host') || 'localhost:3000';\n    const baseUrl = `${protocol}://${host}`;\n\n    return products.map((product) => {\n      // Create a clone of the product to avoid modifying the original\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n      const transformed = Object.create(\n        Object.getPrototypeOf(product),\n        Object.getOwnPropertyDescriptors(product),\n      );\n      // Transform image cover URL\n      if (transformed.imgCover && !transformed.imgCover.startsWith('http')) {\n        transformed.imgCover = `${baseUrl}/uploads/${transformed.imgCover}`;\n      }\n      // Transform size chart image URL\n      if (\n        transformed.imgSizeChart &&\n        !transformed.imgSizeChart.startsWith('http')\n      ) {\n        transformed.imgSizeChart = `${baseUrl}/uploads/${transformed.imgSizeChart}`;\n      }\n      // Transform measure image URL\n      if (\n        transformed.imgMeasure &&\n        !transformed.imgMeasure.startsWith('http')\n      ) {\n        transformed.imgMeasure = `${baseUrl}/uploads/${transformed.imgMeasure}`;\n      }\n      // Transform product images URLs\n      if (transformed.images && Array.isArray(transformed.images)) {\n        transformed.images = transformed.images.map((img: string) =>\n          img && !img.startsWith('http') ? `${baseUrl}/uploads/${img}` : img,\n        );\n      }\n      // Transform color images URLs\n      if (transformed.colors && Array.isArray(transformed.colors)) {\n        transformed.colors = transformed.colors.map((color) => ({\n          ...color,\n          imgColor:\n            color.imgColor && !color.imgColor.startsWith('http')\n              ? `${baseUrl}/uploads/${color.imgColor}`\n              : color.imgColor,\n        }));\n      }\n\n      return transformed;\n    });\n  }\n  /** ----------  Get All Products  ---------- */\n  async getAllProducts(\n    query: ParsedQs,\n    req?: Request,\n  ): Promise<{\n    status: string;\n    results: number;\n    total: number;\n    currentPage: number;\n    limit: number;\n    totalPages: number;\n    lastPage: number;\n    data: product[];\n  }> {\n    try {\n      this.logger.debug(\n        `Starting getAllProducts with query: ${JSON.stringify(query)}`,\n        'ProductCrud',\n      );\n\n      const queryBuilder = this.productRepo\n        .createQueryBuilder('product')\n        .leftJoinAndSelect('product.category', 'category')\n        .leftJoinAndSelect('product.subCategory', 'subCategory')\n        .leftJoinAndSelect('product.poster', 'auth')\n        .select([\n          'product.id',\n          'product.name',\n          'product.season',\n          'product.wordKeys',\n          'product.videoLink',\n          'product.description',\n          'product.images',\n          'product.productIdsCollection',\n          'product.imgCover',\n          'product.imgSizeChart',\n          'product.imgMeasure',\n          'product.sizeDetails',\n          'product.publishState',\n          'product.colors',\n          'product.quantity',\n          'product.isFeatured',\n          'product.isTrending',\n          'product.isNew',\n          'product.isBestSeller',\n          'product.isDeleted',\n          'product.sales',\n          'product.datePublished',\n          'product.createdAt',\n          'product.PosterAt',\n          'product.updatedAt',\n          'category.id',\n          'category.name',\n          'subCategory.name',\n          'subCategory.id',\n          'auth.username',\n        ]);\n\n      this.logger.debug('Query builder created successfully', 'ProductCrud');\n\n      const features = new ApiFeatures(\n        queryBuilder,\n        query || {},\n        this.productRepo.metadata,\n      )\n        .filter()\n        .sort()\n        .paginate();\n\n      this.logger.debug('ApiFeatures applied successfully', 'ProductCrud');\n\n      this.logger.logDatabaseOperation(\n        'SELECT',\n        'product',\n        { query: query },\n        'ProductCrud',\n      );\n      const [data, total] = await features.getManyAndCount();\n      this.logger.info(\n        `Query executed successfully. Found ${data.length} products, total: ${total}`,\n        'ProductCrud',\n      );\n\n      const transformedData = req ? this.transformProductUrls(data, req) : data;\n      this.logger.debug('Data transformation completed', 'ProductCrud');\n\n      const pagination = features.getPaginationInfo();\n\n      const result = {\n        status: 'success',\n        results: transformedData.length,\n        total,\n        currentPage: pagination.page,\n        limit: pagination.limit,\n        totalPages: Math.ceil(total / pagination.limit),\n        lastPage: Math.ceil(total / pagination.limit),\n        data: transformedData,\n      };\n\n      this.logger.debug(\n        `Returning result: ${JSON.stringify({\n          status: result.status,\n          results: result.results,\n          total: result.total,\n          currentPage: result.currentPage,\n          limit: result.limit,\n        })}`,\n        'ProductCrud',\n      );\n\n      return result;\n    } catch (error) {\n      this.logger.logError(error, 'ProductCrud', { query: query });\n      throw error;\n    }\n  }\n  async create(\n    dto: CreateProductDto,\n    files: UploadFiles = {},\n    poster: auth,\n    req?: Request,\n  ): Promise<product> {\n    // 1) بناء الكيان الأساسي\n    const Product = new product();\n    const existingProduct = await this.productRepo.findOne({\n      where: { name: dto.name },\n    });\n    if (existingProduct)\n      throw new BadRequestException('Product name already exists');\n    Product.name = dto.name;\n    Product.description = dto.description;\n    Product.poster = { id: poster.id, username: poster.username };\n    Product.category = await this.fetchCategory(dto.categoryId);\n    Product.subCategory = await this.fetchSubCategory(\n      dto.categoryId,\n      dto.subCategoryId,\n    );\n    Product.publishState = dto.publishState as PublishState;\n\n    // 2) Save images to file system and store paths in database\n    try {\n      // Initialize image fields\n      Product.imgCover = '';\n      Product.imgSizeChart = '';\n      Product.imgMeasure = '';\n      Product.images = [];\n\n      // Save cover image if provided\n      if (files.imgCover && files.imgCover[0]) {\n        Product.imgCover = await this.saveFile(\n          files.imgCover[0],\n          dto.name,\n          'cover',\n        );\n      }\n\n      // Save size chart image if provided\n      if (files.imgSizeChart && files.imgSizeChart[0]) {\n        Product.imgSizeChart = await this.saveFile(\n          files.imgSizeChart[0],\n          dto.name,\n          'sizechart',\n        );\n      }\n\n      // Save measure image if provided\n      if (files.imgMeasure && files.imgMeasure[0]) {\n        Product.imgMeasure = await this.saveFile(\n          files.imgMeasure[0],\n          dto.name,\n          'measure',\n        );\n      }\n\n      // Validate that the count of color images matches the count of color names\n      if (files.imgColors && files.imgColors.length !== dto.colors?.length) {\n        throw new BadRequestException(\n          'The count of color images must match the count of color names',\n          'COLORS_AND_IMAGES_COUNT_DO_NOT_MATCH',\n        );\n      }\n\n      // Save gallery images if provided\n      if (files.images && files.images.length > 0) {\n        Product.images = await this.saveFiles(files.images, dto.name, 'images');\n      }\n    } catch (error) {\n      console.error('Error saving images:', error);\n      throw new Error('Failed to save product images');\n    }\n\n    // Save color images to file system and validate\n    if (files.imgColors && files.imgColors.length > 0) {\n      if (!dto.colors || !Array.isArray(dto.colors)) {\n        throw new BadRequestException(\n          'Colors array is required when uploading color images',\n        );\n      }\n\n      // Save all color images first\n      const colorImagePaths = await this.saveFiles(\n        files.imgColors,\n        dto.name,\n        'colors',\n      );\n\n      // Map color images to colors array\n      Product.colors = colorImagePaths.map((imgPath, index) => ({\n        name:\n          dto.colors && dto.colors[index]\n            ? dto.colors[index].name\n            : `Color ${index + 1}`,\n        imgColor: imgPath,\n      }));\n    } else if (dto.colors && Array.isArray(dto.colors)) {\n      // Handle colors without images\n      Product.colors = dto.colors.map((color) => ({\n        name: color.name,\n        imgColor: '',\n      }));\n    }\n\n    // 3) Categories\n    Product.category = await this.fetchCategory(dto.categoryId);\n    Product.subCategory = await this.fetchSubCategory(\n      dto.categoryId,\n      dto.subCategoryId,\n    );\n\n    // Poster is already assigned in the initial setup\n\n    // 6) Size Details\n    // Validate that color names in quantities match the defined colors\n    if (\n      dto.sizes &&\n      Array.isArray(dto.sizes) &&\n      dto.colors &&\n      Array.isArray(dto.colors)\n    ) {\n      const colorNames = dto.colors.map((color) => color.name);\n      const sizeColorNames = new Set<string>();\n\n      // Collect all color names used in sizes\n      for (const size of dto.sizes) {\n        for (const colorQty of size.quantities) {\n          sizeColorNames.add(colorQty.colorName);\n        }\n      }\n\n      // Convert set to array for comparison\n      const uniqueSizeColorNames = Array.from(sizeColorNames);\n\n      // Check if the count and names match exactly\n      if (uniqueSizeColorNames.length !== colorNames.length) {\n        throw new BadRequestException(\n          'Number of colors in sizes does not match the number of colors defined in the colors list',\n        );\n      }\n\n      // Check if all colors in sizes exist in colors array and vice versa\n      for (const colorName of uniqueSizeColorNames) {\n        if (!colorNames.includes(colorName)) {\n          throw new BadRequestException(\n            `Color \"${colorName}\" used in sizes is not defined in the colors list`,\n          );\n        }\n      }\n\n      for (const colorName of colorNames) {\n        if (!uniqueSizeColorNames.includes(colorName)) {\n          throw new BadRequestException(\n            `Color \"${colorName}\" defined in colors list is not used in any size`,\n          );\n        }\n      }\n    }\n    //  Date Published\n    if (dto.datePublished) {\n      Product.datePublished = dto.datePublished;\n      Product.publishState = PublishState.DRAFT;\n    }\n    Product.sizeDetails = dto.sizes.map((size) => ({\n      sizeName: size.sizeName,\n      price: size.price,\n      quantities: size.quantities.map((colorQty) => ({\n        colorName: colorQty.colorName,\n        quantity: colorQty.quantity,\n      })),\n    }));\n\n    if (dto.wordKeys) Product.wordKeys = dto.wordKeys;\n    if (dto.videoLink) Product.videoLink = dto.videoLink;\n    if (dto.season) Product.season = dto.season;\n\n    // Calculate total quantity\n    Product.quantity = Product.getTotalQuantity();\n\n    try {\n      // Save the product to database\n      const savedProduct = await this.productRepo.save(Product);\n\n      // Transform file paths to full URLs if request object is provided\n      if (req) {\n        const [transformedProduct] = this.transformProductUrls(\n          [savedProduct],\n          req,\n        );\n        return transformedProduct;\n      }\n\n      return savedProduct;\n    } catch (error) {\n      console.error('Error saving product:', error);\n      throw new Error('Failed to save product');\n    }\n  }\n  /** ----------  Update  ---------- */\n  async update(\n    id: number,\n    dto: UpdateProductDto,\n    files: UploadFiles = {},\n    req: Request,\n  ): Promise<product> {\n    const product = await this.productRepo.findOne({\n      where: { id },\n      relations: ['category', 'subCategory', 'poster'],\n    });\n    if (!product) throw new NotFoundException('Product not found');\n    if (dto.name) product.name = dto.name;\n    if (dto.description) product.description = dto.description;\n    if (dto.categoryId)\n      product.category = await this.fetchCategory(dto.categoryId);\n    if (dto.subCategoryId)\n      product.subCategory = await this.fetchSubCategory(\n        dto.categoryId as number,\n        dto.subCategoryId,\n      );\n    if (dto.publishState) product.publishState = dto.publishState;\n\n    // Update files if provided - save to file system and handle old files properly\n    try {\n      // Handle product images (multiple files)\n      if (files.images && files.images.length > 0) {\n        // Delete old images if they exist\n        if (product.images && product.images.length > 0) {\n          this.fileStorageService.deleteFiles(product.images);\n        }\n        // Save new images\n        product.images = await this.saveFiles(\n          files.images,\n          product.name,\n          'images',\n        );\n      }\n\n      // Handle product cover image (single file)\n      if (files.imgCover && files.imgCover[0]) {\n        // Delete old cover image if it exists\n        if (product.imgCover) {\n          this.fileStorageService.deleteFile(product.imgCover);\n        }\n        // Save new cover image\n        product.imgCover = await this.saveFile(\n          files.imgCover[0],\n          product.name,\n          'cover',\n        );\n      }\n\n      // Handle size chart image (single file)\n      if (files.imgSizeChart && files.imgSizeChart[0]) {\n        // Delete old size chart image if it exists\n        if (product.imgSizeChart) {\n          this.fileStorageService.deleteFile(product.imgSizeChart);\n        }\n        // Save new size chart image\n        product.imgSizeChart = await this.saveFile(\n          files.imgSizeChart[0],\n          product.name,\n          'sizechart',\n        );\n      }\n\n      // Handle measure image (single file)\n      if (files.imgMeasure && files.imgMeasure[0]) {\n        // Delete old measure image if it exists\n        if (product.imgMeasure) {\n          this.fileStorageService.deleteFile(product.imgMeasure);\n        }\n        // Save new measure image\n        product.imgMeasure = await this.saveFile(\n          files.imgMeasure[0],\n          product.name,\n          'measure',\n        );\n      }\n    } catch (error) {\n      console.error('Error handling product files:', error);\n      throw new Error(`Failed to process product files: ${error.message}`);\n    }\n\n    // Update category and subcategory if provided\n    if (dto.categoryId)\n      product.category = await this.fetchCategory(dto.categoryId);\n    if (dto.subCategoryId && dto.categoryId)\n      product.subCategory = await this.fetchSubCategory(\n        dto.categoryId,\n        dto.subCategoryId,\n      );\n    if (dto.sizes && dto.sizes.length > 0) {\n      product.sizeDetails = dto.sizes.map((size, index) => ({\n        sizeName: size?.sizeName,\n        price: size?.price || product.sizeDetails[index].price,\n        quantities: size?.quantities\n          ? size.quantities.map((q, index) => ({\n              colorName: q.colorName,\n              quantity:\n                q?.quantity !== undefined\n                  ? q.quantity\n                  : product.sizeDetails[index].quantities[index].quantity,\n              // imgColors:\n              //   q.imgColors ||\n              //   product.sizeDetails[index].quantities[index].imgColors,\n            }))\n          : product.sizeDetails[index].quantities,\n      }));\n    }\n    try {\n      if (\n        dto.colors &&\n        dto.colors.length > 0 &&\n        files.imgColors &&\n        files.imgColors.length > 0\n      ) {\n        if (product.colors && product.colors.length > 0) {\n          const oldColorImages = product.colors\n            .map((color) => color.imgColor)\n            .filter(\n              (imgPath): imgPath is string => !!imgPath && imgPath.length > 0,\n            );\n\n          if (oldColorImages.length > 0) {\n            this.fileStorageService.deleteFiles(oldColorImages);\n          }\n        }\n\n        // Save new color images to file system\n        const colorImagePaths = await this.saveFiles(\n          files.imgColors,\n          product.name,\n          'colors',\n        );\n\n        product.colors = dto.colors.map((color, index) => ({\n          name:\n            color.name ||\n            (product.colors && product.colors[index]\n              ? product.colors[index].name\n              : ''),\n          imgColor:\n            colorImagePaths[index] ||\n            (product.colors && product.colors[index]\n              ? product.colors[index].imgColor\n              : ''),\n        }));\n      } else if (dto.colors && dto.colors.length > 0) {\n        // Update color names but keep existing image paths\n        product.colors = dto.colors.map((color, index) => ({\n          name:\n            color.name ||\n            (product.colors && product.colors[index]\n              ? product.colors[index].name\n              : ''),\n          imgColor:\n            product.colors && product.colors[index]\n              ? product.colors[index].imgColor\n              : '',\n        }));\n      }\n    } catch (error) {\n      console.error('Error handling product color images:', error);\n      throw new Error(\n        `Failed to process product color images: ${error.message}`,\n      );\n    }\n    product.updatedAt = new Date();\n    await this.productRepo.update(id, product);\n    const updatedProduct = await this.productRepo.findOne({\n      where: { id },\n      relations: ['category', 'subCategory', 'poster'],\n    });\n    if (!updatedProduct) {\n      throw new NotFoundException(\n        `Product with ID ${id} not found after update`,\n      );\n    }\n    if (req) {\n      const [transformedProduct] = this.transformProductUrls(\n        [updatedProduct],\n        req,\n      );\n      return transformedProduct;\n    }\n    return updatedProduct;\n  }\n  /** ----------  Helpers  ---------- */\n  private async fetchCategory(id: number): Promise<any> {\n    const cat = await this.categoryRepo.findOne({\n      where: { id },\n      relations: ['subCategories'],\n    });\n    if (!cat) throw new NotFoundException(`Category ${id} not found`);\n\n    return { id: cat.id, name: cat.name };\n  }\n  private async fetchSubCategory(idCat: number, idSub: number): Promise<any> {\n    const sub = await this.subCategoryRepo.findOneBy({\n      id: idSub,\n      category: { id: idCat },\n    });\n    if (!sub)\n      throw new NotFoundException(\n        'SubCategory not found or not exist in this category',\n      );\n    return { id: sub.id, name: sub.name };\n  }\n  async remove(\n    id: number,\n  ): Promise<{ success: boolean; product?: any; message?: string }> {\n    const product = await this.productRepo.findOneBy({ id });\n    if (!product) throw new NotFoundException('Product not found');\n\n    const productInfo = {\n      id: product.id,\n      name: product.name,\n    };\n\n    // Delete the entire product directory\n    const productPath = `products/${product.name.replace(/\\s+/g, '_').toLowerCase()}`;\n    this.fileStorageService.deleteDirectory(productPath);\n\n    try {\n      await this.productRepo.remove(product);\n      return {\n        success: true,\n        product: productInfo,\n        message: 'Product deleted successfully',\n      };\n    } catch (error) {\n      console.error('Error deleting product:', error);\n      throw new BadRequestException(`Error deleting product: ${error.message}`);\n    }\n  }\n\n  async findOne(id: number): Promise<any> {\n    const product = await this.productRepo.findOne({\n      where: { id },\n      relations: ['category', 'subCategory'],\n    });\n\n    if (!product) {\n      throw new NotFoundException(`Product with ID ${id} not found`);\n    }\n    return product;\n  }\n  async deleteAll(): Promise<void> {\n    const productPath = `products`;\n    this.fileStorageService.deleteDirectory(productPath);\n    await this.productRepo\n      .createQueryBuilder()\n      .delete()\n      .from(product)\n      .where('1 = 1')\n      .execute();\n  }\n  async ConnectProduct(productIds: number[]): Promise<any> {\n    const productsIds: number[] = [];\n    const products = await Promise.all(\n      productIds.map(async (id) => {\n        const prod = await this.productRepo.findOne({ where: { id } });\n        if (!prod) {\n          throw new NotFoundException(`Product with ID ${id} not found`);\n        }\n        productsIds.push(prod.id);\n        return prod;\n      }),\n    );\n    for (const prod of products) {\n      prod.productIdsCollection = productsIds;\n      await this.productRepo.save(prod);\n    }\n    return {\n      data: products,\n      message: 'Products connected successfully',\n    };\n  }\n}\n"],"names":["ProductCrud","saveFiles","files","productName","subDirectory","productPath","replace","toLowerCase","fileStorageService","quality","format","progressive","saveFile","file","uploadFiles","result","images","length","imgCover","imgSizeChart","imgMeasure","imgColors","transformProductUrls","products","req","protocol","host","get","baseUrl","map","product","transformed","Object","create","getPrototypeOf","getOwnPropertyDescriptors","startsWith","Array","isArray","img","colors","color","imgColor","getAllProducts","query","logger","debug","JSON","stringify","queryBuilder","productRepo","createQueryBuilder","leftJoinAndSelect","select","features","ApiFeatures","metadata","filter","sort","paginate","logDatabaseOperation","data","total","getManyAndCount","info","transformedData","pagination","getPaginationInfo","status","results","currentPage","page","limit","totalPages","Math","ceil","lastPage","error","logError","dto","poster","Product","existingProduct","findOne","where","name","BadRequestException","description","id","username","category","fetchCategory","categoryId","subCategory","fetchSubCategory","subCategoryId","publishState","console","Error","colorImagePaths","imgPath","index","sizes","colorNames","sizeColorNames","Set","size","colorQty","quantities","add","colorName","uniqueSizeColorNames","from","includes","datePublished","PublishState","DRAFT","sizeDetails","sizeName","price","quantity","wordKeys","videoLink","season","getTotalQuantity","savedProduct","save","transformedProduct","update","relations","NotFoundException","deleteFiles","deleteFile","message","q","undefined","oldColorImages","updatedAt","Date","updatedProduct","cat","categoryRepo","idCat","idSub","sub","subCategoryRepo","findOneBy","remove","productInfo","deleteDirectory","success","deleteAll","delete","execute","ConnectProduct","productIds","productsIds","Promise","all","prod","push","productIdsCollection","constructor","configService"],"mappings":"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"}