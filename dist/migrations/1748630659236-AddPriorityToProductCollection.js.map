{"version":3,"sources":["../../src/migrations/1748630659236-AddPriorityToProductCollection.ts"],"sourcesContent":["import {\r\n  MigrationInterface,\r\n  QueryRunner,\r\n  TableColumn,\r\n  TableIndex,\r\n} from 'typeorm';\r\n\r\nexport class AddPriorityToProductCollection1748630659236\r\n  implements MigrationInterface\r\n{\r\n  name = 'AddPriorityToProductCollection1748630659236';\r\n\r\n  public async up(queryRunner: QueryRunner): Promise<void> {\r\n    const table = await queryRunner.getTable('product_collection');\r\n\r\n    if (table) {\r\n      // Add displayPriority if not exists\r\n      if (!table.findColumnByName('displayPriority')) {\r\n        await queryRunner.addColumn(\r\n          'product_collection',\r\n          new TableColumn({\r\n            name: 'displayPriority',\r\n            type: 'int',\r\n            default: 0,\r\n            comment: 'Display priority (higher number = higher priority)',\r\n          }),\r\n        );\r\n      }\r\n\r\n      // Add isPriority if not exists\r\n      if (!table.findColumnByName('isPriority')) {\r\n        await queryRunner.addColumn(\r\n          'product_collection',\r\n          new TableColumn({\r\n            name: 'isPriority',\r\n            type: 'boolean',\r\n            default: false,\r\n            comment: 'Mark as priority collection for special display',\r\n          }),\r\n        );\r\n      }\r\n\r\n      // Add index if not exists\r\n      const hasIndex = table.indices.some(\r\n        (idx) => idx.name === 'IDX_PRODUCT_COLLECTION_PRIORITY',\r\n      );\r\n\r\n      if (!hasIndex) {\r\n        await queryRunner.createIndex(\r\n          'product_collection',\r\n          new TableIndex({\r\n            name: 'IDX_PRODUCT_COLLECTION_PRIORITY',\r\n            columnNames: ['displayPriority', 'isPriority'],\r\n          }),\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  public async down(queryRunner: QueryRunner): Promise<void> {\r\n    await queryRunner.dropIndex(\r\n      'product_collection',\r\n      'IDX_PRODUCT_COLLECTION_PRIORITY',\r\n    );\r\n\r\n    const table = await queryRunner.getTable('product_collection');\r\n    if (table) {\r\n      if (table.findColumnByName('displayPriority')) {\r\n        await queryRunner.dropColumn('product_collection', 'displayPriority');\r\n      }\r\n      if (table.findColumnByName('isPriority')) {\r\n        await queryRunner.dropColumn('product_collection', 'isPriority');\r\n      }\r\n    }\r\n  }\r\n}\r\n"],"names":["AddPriorityToProductCollection1748630659236","up","queryRunner","table","getTable","findColumnByName","addColumn","TableColumn","name","type","default","comment","hasIndex","indices","some","idx","createIndex","TableIndex","columnNames","down","dropIndex","dropColumn"],"mappings":";;;;+BAOaA;;;eAAAA;;;yBAFN;AAEA,IAAA,AAAMA,8CAAN,MAAMA;IAKX,MAAaC,GAAGC,WAAwB,EAAiB;QACvD,MAAMC,QAAQ,MAAMD,YAAYE,QAAQ,CAAC;QAEzC,IAAID,OAAO;YACT,oCAAoC;YACpC,IAAI,CAACA,MAAME,gBAAgB,CAAC,oBAAoB;gBAC9C,MAAMH,YAAYI,SAAS,CACzB,sBACA,IAAIC,oBAAW,CAAC;oBACdC,MAAM;oBACNC,MAAM;oBACNC,SAAS;oBACTC,SAAS;gBACX;YAEJ;YAEA,+BAA+B;YAC/B,IAAI,CAACR,MAAME,gBAAgB,CAAC,eAAe;gBACzC,MAAMH,YAAYI,SAAS,CACzB,sBACA,IAAIC,oBAAW,CAAC;oBACdC,MAAM;oBACNC,MAAM;oBACNC,SAAS;oBACTC,SAAS;gBACX;YAEJ;YAEA,0BAA0B;YAC1B,MAAMC,WAAWT,MAAMU,OAAO,CAACC,IAAI,CACjC,CAACC,MAAQA,IAAIP,IAAI,KAAK;YAGxB,IAAI,CAACI,UAAU;gBACb,MAAMV,YAAYc,WAAW,CAC3B,sBACA,IAAIC,mBAAU,CAAC;oBACbT,MAAM;oBACNU,aAAa;wBAAC;wBAAmB;qBAAa;gBAChD;YAEJ;QACF;IACF;IAEA,MAAaC,KAAKjB,WAAwB,EAAiB;QACzD,MAAMA,YAAYkB,SAAS,CACzB,sBACA;QAGF,MAAMjB,QAAQ,MAAMD,YAAYE,QAAQ,CAAC;QACzC,IAAID,OAAO;YACT,IAAIA,MAAME,gBAAgB,CAAC,oBAAoB;gBAC7C,MAAMH,YAAYmB,UAAU,CAAC,sBAAsB;YACrD;YACA,IAAIlB,MAAME,gBAAgB,CAAC,eAAe;gBACxC,MAAMH,YAAYmB,UAAU,CAAC,sBAAsB;YACrD;QACF;IACF;;aAhEAb,OAAO;;AAiET"}