{"version":3,"sources":["../../src/order/order.repository.ts"],"sourcesContent":["/* eslint-disable prettier/prettier */\n/* eslint-disable @typescript-eslint/no-unsafe-member-access */\n\nimport {\n  Injectable,\n  BadRequestException,\n  NotFoundException,\n} from '@nestjs/common';\nimport { InjectRepository } from '@nestjs/typeorm';\nimport { Repository } from 'typeorm';\nimport { order, orderitem } from './order.entity';\nimport { CreateOrderDto, UpdateOrderDto } from './order.dto';\nimport { product } from 'src/product/entities/product.entity';\nimport { OrderStatus } from './order.types';\nimport { auth } from 'src/auth/entities/auth.entity';\nimport { OptosShipmentService } from 'src/optos/optos.shipment.service';\nimport { CreateShipmentDto } from 'src/optos/optos.dto';\n\n@Injectable()\nexport class OrderRepository {\n  constructor(\n    @InjectRepository(order)\n    private readonly orderRepo: Repository<order>,\n    @InjectRepository(product)\n    private readonly productRepo: Repository<product>,\n    @InjectRepository(auth)\n    private readonly authRepo: Repository<auth>,\n    private readonly optosService: OptosShipmentService,\n  ) {}\n\n  async createOrder(dto: CreateOrderDto): Promise<order> {\n    const Order = new order();\n    // order.business = 1; // Set explicit business value\n    Order.items = [];\n    for (const item of dto.items) {\n      const product = await this.productRepo.findOne({\n        where: { id: item.productId },\n        relations: ['category', 'subCategory'],\n      });\n      if (!product)\n        throw new BadRequestException(`Product ${item.productId} not found`);\n\n      const size = product.sizeDetails.find(\n        (size) => size.sizeName === item.sizeName,\n      );\n      if (!size) {\n        throw new BadRequestException(\n          `Size ${item.sizeName} not found in product ${product.id}`,\n        );\n      }\n\n      const color = size.quantities.find((q) => q.colorName === item.colorName);\n      if (!color) {\n        throw new BadRequestException(\n          `Color ${item.colorName} not found in product ${product.id} with size ${item.sizeName}`,\n        );\n      }\n\n      // Check if there's enough quantity for this specific size and color\n      if (color.quantity < item.quantity) {\n        throw new BadRequestException(\n          `Insufficient quantity. Available: ${color.quantity}, Requested: ${item.quantity} for product ${product.id} with size ${item.sizeName} and color ${item.colorName}`,\n        );\n      }\n\n      if (item.quantity <= 0) {\n        throw new BadRequestException(\n          `Quantity of ${item.quantity} is not valid for product ${product.id}`,\n        );\n      }\n\n      const orderItem = new orderitem();\n      orderItem.product = product;\n      orderItem.productId = product.id;\n      orderItem.sizeName = size.sizeName;\n      orderItem.colorName = color.colorName;\n      orderItem.quantity = item.quantity;\n      orderItem.order = Order;\n      Order.items.push(orderItem);\n\n      // Update the specific color quantity for this size\n      color.quantity -= item.quantity;\n      await this.productRepo.save(product);\n    }\n    // First save the order\n    const savedOrder = await this.orderRepo.save(Order);\n\n    // Calculate total amount after items are saved\n    savedOrder.amount = Order.items.reduce(\n      (total, item) => total + item.price * item.quantity,\n      0,\n    );\n    Order.consignee_name = dto.consignee_name;\n    Order.consignee_phone = dto.consignee_phone;\n    Order.consignee_city = dto.consignee_city;\n    Order.consignee_area = dto.consignee_area;\n    Order.consignee_address = dto.consignee_address;\n    Order.shipment_types = dto.shipment_types;\n    Order.quantity = dto.items\n      .reduce((total, item) => total + item.quantity, 0)\n      .toString();\n    Order.items_description = dto.items_description;\n    Order.is_cod = dto.is_cod;\n    Order.cod_amount = Order.amount.toString();\n    Order.has_return = dto.has_return;\n    Order.return_notes = dto.return_notes;\n    Order.notes = dto.notes;\n\n    //optos create shipment\n    const shipmentDto: CreateShipmentDto = {\n      consignee_name: dto.consignee_name,\n      consignee_phone: dto.consignee_phone,\n      consignee_city: dto.consignee_city,\n      consignee_area: dto.consignee_area,\n      consignee_address: dto.consignee_address,\n      shipment_types: dto.shipment_types,\n      quantity: Order.quantity,\n      items_description: dto.items_description,\n      is_cod: dto.is_cod === '1' ? '1' : '0',\n      cod_amount: Order.amount.toString(),\n      has_return: dto.has_return === '1' ? '1' : '0',\n      return_notes: dto.return_notes,\n      notes: dto.notes,\n    };\n    await this.optosService.createShipment(shipmentDto).then((res) => {\n      Order.optos_id = res.id;\n      Order.optos_status = res.status;\n    });\n    // Update the order with the calculated amount\n    return this.orderRepo.save(savedOrder);\n  }\n  async updateOrder(id: string, orderDto: UpdateOrderDto): Promise<order> {\n    const order = await this.orderRepo.findOne({ where: { id } });\n    if (!order) {\n      throw new NotFoundException(`Order ${id} not found`);\n    }\n\n    // Safely update string fields\n    if (orderDto.consignee_name) order.consignee_name = orderDto.consignee_name;\n    if (orderDto.consignee_phone)\n      order.consignee_phone = orderDto.consignee_phone;\n    if (orderDto.consignee_city) order.consignee_city = orderDto.consignee_city;\n    if (orderDto.consignee_area) order.consignee_area = orderDto.consignee_area;\n    if (orderDto.consignee_address)\n      order.consignee_address = orderDto.consignee_address;\n    if (orderDto.shipment_types) order.shipment_types = orderDto.shipment_types;\n    if (orderDto.items_description)\n      order.items_description = orderDto.items_description;\n    if (orderDto.return_notes) order.return_notes = orderDto.return_notes;\n    if (orderDto.notes) order.notes = orderDto.notes;\n\n    if (orderDto.is_cod) {\n      order.is_cod = orderDto.is_cod;\n    }\n\n    if (orderDto.has_return) {\n      order.has_return = orderDto.has_return;\n    }\n\n    if (orderDto.items) {\n      const orderItems = await Promise.all(\n        orderDto.items.map(async (item) => {\n          const orderItem = new orderitem();\n          const product = await this.productRepo.findOne({\n            where: { id: item.productId },\n            relations: ['category', 'subCategory'],\n          });\n          if (!product) {\n            throw new BadRequestException(\n              `Product ${item.productId} not found`,\n            );\n          }\n          const size = product.sizeDetails.find(\n            (size) => size.sizeName === item.sizeName,\n          );\n          if (!size) {\n            throw new BadRequestException(\n              `Size ${item.sizeName} not found in product ${product.id}`,\n            );\n          }\n          const color = size.quantities.find(\n            (q) => q.colorName === item.colorName,\n          );\n          if (!color) {\n            throw new BadRequestException(\n              `Color ${item.colorName} not found in product ${product.id} with size ${item.sizeName}`,\n            );\n          }\n          orderItem.product = product; // Set the product object\n          orderItem.productId = product.id;\n          orderItem.sizeName = size.sizeName;\n          orderItem.colorName = color.colorName;\n          orderItem.quantity = item.quantity;\n          orderItem.order = order;\n          return orderItem;\n        }),\n      );\n      order.items = orderItems;\n      // Update the order with the new items\n      return this.orderRepo.save(order);\n    }\n    return order;\n  }\n\n  async updateOrderStatusToReadied(id: string): Promise<order> {\n    const order = await this.orderRepo.findOne({ where: { id } });\n    if (!order) {\n      throw new NotFoundException(`Order ${id} not found`);\n    }\n    order.status = OrderStatus.READIED;\n    const updatedOrder = await this.orderRepo.save(order);\n    return updatedOrder;\n  }\n\n  async updateOrderStatusToShipped(id: string): Promise<void> {\n    const order = await this.orderRepo.findOne({ where: { id } });\n    if (!order) {\n      throw new NotFoundException(`Order ${id} not found`);\n    }\n    order.status = OrderStatus.SHIPPED;\n    await this.orderRepo.save(order);\n    return;\n  }\n\n  async updateOrderStatusToCancelled(id: string): Promise<void> {\n    const order = await this.orderRepo.findOne({\n      where: { id },\n      relations: ['items', 'items.product'],\n    });\n\n    if (!order) {\n      throw new NotFoundException(`Order ${id} not found`);\n    }\n\n    // Return all items to inventory before cancelling the order\n    if (order.items && order.items.length > 0) {\n      for (const item of order.items) {\n        if (item.product && item.product.sizeDetails) {\n          // Find the specific size and color combination\n          const sizeDetail = item.product.sizeDetails.find(\n            (size) => size.sizeName === item.sizeName,\n          );\n\n          if (sizeDetail) {\n            const colorQuantity = sizeDetail.quantities.find(\n              (colorQty) => colorQty.colorName === item.colorName,\n            );\n\n            if (colorQuantity) {\n              // Return the quantity back to inventory\n              colorQuantity.quantity += item.quantity;\n            }\n          }\n\n          // Save the updated product\n          await this.orderRepo.manager.save(item.product);\n        }\n      }\n    }\n\n    order.status = OrderStatus.CANCELLED;\n    await this.orderRepo.save(order);\n  }\n\n  async getAllOrders(): Promise<order[]> {\n    const orders = await this.orderRepo.find();\n    for (const order of orders) {\n      if (order.optos_id) {\n        await this.updateOrderOptosStatus(order.optos_id);\n      }\n    }\n    const finalOrders = await this.orderRepo.find();\n    return finalOrders;\n  }\n\n  async getOrderById(id: string): Promise<order> {\n    const order = await this.orderRepo.findOne({ where: { id } });\n    if (!order) {\n      throw new NotFoundException(`Order ${id} not found`);\n    }\n    return order;\n  }\n\n  async getOrdersByStatus(status: OrderStatus): Promise<order[]> {\n    return this.orderRepo.find({ where: { status } });\n  }\n\n  async deleteOrder(id: string): Promise<void> {\n    const order = await this.orderRepo.findOne({ where: { id } });\n    if (!order) {\n      throw new NotFoundException(`Order ${id} not found`);\n    }\n    await this.orderRepo.remove(order);\n  }\n\n  async addReadyBy(id: string, readyById: string): Promise<order> {\n    const order = await this.getOrderById(id);\n    const readyBy = await this.authRepo.findOne({ where: { id: readyById } });\n    if (!readyBy) {\n      throw new NotFoundException(`Ready by user ${readyById} not found`);\n    }\n    const readyByUser = new auth();\n    readyByUser.username = readyBy.username;\n    order.readyBy = readyByUser;\n    const optos: CreateShipmentDto = {\n      consignee_name: order.consignee_name,\n      consignee_phone: order.consignee_phone,\n      consignee_city: String(order.consignee_city),\n      consignee_area: String(order.consignee_area),\n      consignee_address: order.consignee_address,\n      shipment_types: String(order.shipment_types),\n      quantity: String(order.quantity),\n      items_description: order.items_description,\n      is_cod: order.is_cod ? '1' : '0',\n      cod_amount: String(order.cod_amount),\n      has_return: order.has_return ? '1' : '0',\n      return_notes: order.return_notes,\n      notes: order.notes,\n    };\n    await this.optosService.createShipment(optos);\n    return this.orderRepo.save(order);\n  }\n\n  async updateOrderOptosStatus(optosId: number): Promise<order> {\n    const order = await this.orderRepo.findOne({\n      where: { optos_id: optosId },\n    });\n    if (!order) {\n      throw new NotFoundException(`Order with optos_id ${optosId} not found`);\n    }\n    const res = await this.optosService.getShipment({ id: optosId });\n\n    // Add null checks to prevent the error\n    if (res && res[0] && res[0].data && res[0].data[0]) {\n      console.log(res[0].data[0].status);\n      order.optos_status = res[0].data[0].status;\n    } else {\n      console.log(`No shipment data found for optos_id: ${optosId}`);\n      // You can set a default status or leave it as is\n      order.optos_status = order.optos_status || '';\n    }\n\n    return await this.orderRepo.save(order);\n  }\n\n  async deleteAllOrders(): Promise<void> {\n    await this.orderRepo.createQueryBuilder().delete().execute();\n  }\n\n  async length(): Promise<number> {\n    return this.orderRepo.count();\n  }\n}\n"],"names":["OrderRepository","createOrder","dto","Order","order","items","item","product","productRepo","findOne","where","id","productId","relations","BadRequestException","size","sizeDetails","find","sizeName","color","quantities","q","colorName","quantity","orderItem","orderitem","push","save","savedOrder","orderRepo","amount","reduce","total","price","consignee_name","consignee_phone","consignee_city","consignee_area","consignee_address","shipment_types","toString","items_description","is_cod","cod_amount","has_return","return_notes","notes","shipmentDto","optosService","createShipment","then","res","optos_id","optos_status","status","updateOrder","orderDto","NotFoundException","orderItems","Promise","all","map","updateOrderStatusToReadied","OrderStatus","READIED","updatedOrder","updateOrderStatusToShipped","SHIPPED","updateOrderStatusToCancelled","length","sizeDetail","colorQuantity","colorQty","manager","CANCELLED","getAllOrders","orders","updateOrderOptosStatus","finalOrders","getOrderById","getOrdersByStatus","deleteOrder","remove","addReadyBy","readyById","readyBy","authRepo","readyByUser","auth","username","optos","String","optosId","getShipment","data","console","log","deleteAllOrders","createQueryBuilder","delete","execute","count","constructor"],"mappings":"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"}