{"version":3,"sources":["../../src/optos/optos.shipment.service.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unsafe-member-access */\n/* eslint-disable @typescript-eslint/no-unsafe-return */\nimport { HttpException, HttpStatus, Injectable } from '@nestjs/common';\nimport { HttpService } from '@nestjs/axios';\n// eslint-disable-next-line @typescript-eslint/no-require-imports\nimport FormData from 'form-data';\nimport { CreateShipmentDto } from './optos.dto';\nimport { OptosService } from './optos.token.service';\nimport { AppConfigService } from 'src/config/config.service';\n\n@Injectable()\nexport class OptosShipmentService {\n  constructor(\n    private readonly httpService: HttpService,\n    private readonly OptosService: OptosService,\n    private readonly configService: AppConfigService,\n  ) {}\n\n  async createShipment(createShipment: CreateShipmentDto): Promise<any> {\n    const data = new FormData();\n    data.append(\n      'business',\n      this.configService.business?.toString(),\n      // createShipment.business || this.configService.business?.toString(),\n    );\n    data.append(\n      'business_address',\n      this.configService.business_address?.toString(),\n      // createShipment.business_address ||\n      //   this.configService.business_address?.toString(),\n    );\n    data.append('consignee[name]', createShipment.consignee_name);\n    data.append('consignee[phone]', createShipment.consignee_phone);\n    data.append('consignee[city]', createShipment.consignee_city);\n    data.append('consignee[area]', createShipment.consignee_area);\n    data.append('consignee[address]', createShipment.consignee_address);\n    data.append('shipment_types[0][id]', createShipment.shipment_types);\n    data.append('quantity', createShipment.quantity);\n    data.append('items_description', createShipment.items_description);\n    data.append('is_cod', createShipment.is_cod || '1');\n    data.append('cod_amount', createShipment.cod_amount);\n    data.append('has_return', createShipment.has_return || '1');\n    data.append('return_notes', createShipment.return_notes || '');\n    data.append('notes', createShipment.notes || '');\n    try {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n      const access_token = await this.OptosService.Login();\n      console.log(access_token);\n      const response = await this.httpService.axiosRef.post(\n        'https://opost.ps/api/resources/shipments',\n        data,\n        {\n          headers: {\n            ...data.getHeaders(),\n            Authorization: `Bearer ${access_token}`,\n            Accept: 'application/json',\n          },\n        },\n      );\n      return response.data;\n    } catch (error) {\n      throw new HttpException(\n        error.response?.data?.message,\n        error.response?.status,\n      );\n    }\n  }\n  async getShipment(query: Record<string, any> = {}) {\n    try {\n      const access_token = await this.OptosService.Login();\n\n      // Build query string from the query object\n      const params = new URLSearchParams(query).toString();\n      const url = `https://opost.ps/api/resources/shipments${params ? '?' + params : ''}`;\n\n      const response = await this.httpService.axiosRef.get(url, {\n        headers: {\n          Authorization: `Bearer ${access_token}`,\n          Accept: 'application/json',\n        },\n        maxBodyLength: Infinity,\n      });\n      return response.data;\n    } catch (error) {\n      console.error('Error fetching shipments:', error.message);\n      throw new HttpException(\n        'Failed to fetch shipments',\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n  async getPendingTypes() {\n    try {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n      const access_token = await this.OptosService.Login();\n      console.log(access_token);\n      const response = await this.httpService.axiosRef.get(\n        'https://opost.ps/api/resources/pending-types',\n        {\n          headers: {\n            Authorization: `Bearer ${access_token}`,\n            Accept: 'application/json',\n          },\n          maxBodyLength: Infinity,\n        },\n      );\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n      return response.data;\n    } catch (error) {\n      throw new HttpException(\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-argument, @typescript-eslint/no-unsafe-member-access\n        error.response?.data?.message || 'Failed to fetch pending types',\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n        error.response?.status || HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n  async getShipmentType() {\n    try {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n      const access_token = await this.OptosService.Login();\n      const response = await this.httpService.axiosRef.get(\n        `https://opost.ps/api/resources/shipment-types`,\n        {\n          headers: {\n            Authorization: `Bearer ${access_token}`,\n            Accept: 'application/json',\n          },\n          maxBodyLength: Infinity,\n        },\n      );\n      return response.data;\n    } catch (error) {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n      console.error('Error fetching shipment types:', error.message);\n      throw new HttpException(\n        'Failed to fetch shipment types',\n        //@typescript-eslint/no-unsafe-member-access\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n}\n"],"names":["OptosShipmentService","createShipment","data","FormData","append","configService","business","toString","business_address","consignee_name","consignee_phone","consignee_city","consignee_area","consignee_address","shipment_types","quantity","items_description","is_cod","cod_amount","has_return","return_notes","notes","access_token","OptosService","Login","console","log","response","httpService","axiosRef","post","headers","getHeaders","Authorization","Accept","error","HttpException","message","status","getShipment","query","params","URLSearchParams","url","get","maxBodyLength","Infinity","HttpStatus","INTERNAL_SERVER_ERROR","getPendingTypes","getShipmentType","constructor"],"mappings":"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"}